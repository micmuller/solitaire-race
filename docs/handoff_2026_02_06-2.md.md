# ğŸƒ Solitaire HighNoon â€“ vNext Handoff

## Ziel dieses Handoffs
Start eines **vNext-Projekts** fÃ¼r Solitaire HighNoon mit klarer Priorisierung:
1. **Projekt-Setup + Protokoll**
2. **Server-authoritative Engine + Bot-Tests**
3. **erst danach iOS-Integration**

Ziel ist maximale Klarheit, frÃ¼he Verifikation und **kein UI-Overhead**, bevor Regeln, Determinismus und Bots sauber laufen.

Kein Big-Bang-Rewrite, sondern kontrollierter Neubau mit Verify-Loops.

---

## ğŸ¯ High-Level-Entscheidungen (final)

### Architektur
- Server ist **Single Source of Truth**
- Clients (iOS, Bot) senden nur **Action / Intent**
- Server antwortet mit **Accepted + Delta**, **Reject** oder **Snapshot**
- Determinismus ist Pflicht (Seed â†’ Events â†’ Hash)
- Bots gelten als **erste Referenz-Clients** (vor iOS)

### iOS
- âŒ Kein sofortiger Fokus
- âœ… iOS kommt **erst nach stabiler Server+Bot-Phase**
- GUI / Board / UX bleiben erhalten
- iOS wird ein **Thin Client**

### Organisation
- Neues ChatGPT-Projekt: **Solitaire HighNoon â€“ vNext**
- Getrennte Git-Branches + gemeinsamer Workspace
- Arbeiten in **Worktrees**, nicht direkt auf `main`

---

## ğŸ—‚ Projekt-Setup (Tag 1 â€“ hÃ¶chste PrioritÃ¤t)

### Git-Struktur

#### Server / Web
```bash
cd solitaire-race
git checkout -b vNext-authoritative-engine
```

#### Bot (falls eigenes Repo)
```bash
git checkout -b vNext-bot
```

#### iOS
```bash
cd HighNoonNative
git checkout -b vNext-ios
# iOS bleibt zunÃ¤chst unberÃ¼hrt
```

#### Gemeinsamer Workspace (empfohlen)
```bash
mkdir -p ~/dev/solitaire-vnext
cd ~/dev/solitaire-vnext
git clone <server-repo-url> server
git clone <ios-repo-url> ios
cd server && git checkout vNext-authoritative-engine
cd ../ios && git checkout vNext-ios
```

---

## ğŸ“œ Pflicht-Dokumente (vNext Contract â€“ Blocker fÃ¼r alles Weitere)

Diese Files gelten als **harte Grundlage**.  
**Ohne sauberes Protokoll kein iOS-Schritt.**

- PROJECT_OVERVIEW.md
- PROTOCOL.md
- DETERMINISM.md
- TEST_MATRIX.md
- VNEXT_CHARTER.md

---

## ğŸ§  Zielbild vNext (ohne iOS)

```
Bot / Test Client
   â†“ Action
Server Engine
   â†“ Delta / Snapshot / Reject
Event Log + State Hash
   â†“
Replay Harness
```

Bots und Replay ersetzen iOS als frÃ¼he Verifikationsinstanz.

---

## ğŸ¤– Bot-first Strategie (bewusst gewÃ¤hlt)

### Warum Bot vor iOS?
- Kein UI â†’ schnelleres Iterieren
- 100% deterministisch testbar
- Ideal fÃ¼r Replay- und Invariant-Tests
- Verhindert, dass UI-Probleme Architekturfehler kaschieren

### Bot ist:
- reiner Action-Generator
- **keine** Regelinstanz
- akzeptiert Rejects kommentarlos
- perfekt fÃ¼r Regression-Tests

---

## ğŸ” Verify-Loop (Blocker-Gate)

### Server (Pflicht)
- Event-Log aller akzeptierten Actions
- State-Hash nach jeder Mutation
- Replay-Script:
  - Seed + Events â†’ Final State
  - Hash-Vergleich (muss identisch sein)

### Bot-Tests
- feste Seeds
- reproduzierbare Action-Sequenzen
- Vergleich: Live-Run vs Replay

**Erst wenn diese Schleife grÃ¼n ist â†’ iOS darf andocken.**

---

## ğŸš¦ Umsetzungsphasen (priorisiert)

### Phase 1 â€“ Projekt-Setup & Protokoll (Tag 1)
- Contract-Dokumente erstellen
- Protokoll versionieren
- Message-Typen definieren
- Reject-Codes festlegen

â¡ï¸ Ergebnis: Klarer, implementierbarer Vertrag

---

### Phase 2 â€“ Server Engine + Bot-Tests (Tag 2â€“3)
- Engine Skeleton:
  - initMatch(mode, seed)
  - applyAction(state, action)
- Invariants:
  - KartenzÃ¤hlung
  - Foundations korrekt
- Bot-Client:
  - liest Snapshot
  - sendet Actions
- Replay Harness

â¡ï¸ Ergebnis: deterministischer Server, bewiesen durch Bot-Replays

---

### Phase 3 â€“ iOS vNext Integration (erst danach)
- iOS Snapshot anzeigen
- Thin Client anbinden
- keine lokalen Regeln
- GUI unverÃ¤ndert

â¡ï¸ iOS profitiert von stabiler Basis

---

## ğŸ§© iOS vNext â€“ KEEP / WRAP / REPLACE (fÃ¼r Phase 3)

### KEEP
- BoardView.swift
- GameView.swift (UI)
- LobbyView.swift
- ContentView.swift

### WRAP
- UI-Validierungen nur advisory
- Drag â†’ ActionIntent

### REPLACE
- WebSocketManager.swift (Legacy)
- lokale Regeln
- lokale State-Mutation

---

## ğŸ¤– Codex â€“ empfohlene Start-Prompts

### System Prompt
```
You are working in branch vNext-authoritative-engine.
You may create new files and folders.
Do not touch the main branch.
Server must be authoritative.
Determinism and replayability are mandatory.
Prefer small, reviewable changes.
Ask before deleting files.
```

---

### Prompt 1 â€“ Contract & Protokoll
```
Create PROJECT_OVERVIEW.md, PROTOCOL.md, DETERMINISM.md, TEST_MATRIX.md.
Focus on server-authoritative solitaire, shared & split modes.
Define message types and reject codes.
No implementation yet.
```

---

### Prompt 2 â€“ Server Engine Skeleton
```
Create a deterministic server game engine with:
- initMatch(mode, seed)
- applyAction(state, action)
Include invariants but no networking.
```

---

### Prompt 3 â€“ Bot & Replay Harness
```
Create a bot client and replay harness.
Bot generates actions only.
Replay must prove deterministic equality via state hashes.
```

---

### Prompt 4 â€“ iOS (erst nach Freigabe)
```
Add iOS vNext skeleton (ProtocolTypes, WS client, AuthoritativeStore).
Do not modify existing UI files.
Assume protocol and server are stable.
```

---

## âœ… Definition of Done (Gate vor iOS)

- Protokoll versioniert & dokumentiert
- Deterministische Server-Replays grÃ¼n
- Bot-Regression stabil
- Invariants enforced
- Kein UI-Code benÃ¶tigt

---

## ğŸ§  Merksatz
**Erst Vertrag. Dann Wahrheit. Dann Bots.  
UI kommt zuletzt.**

End of handoff.
